<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>

<body>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>名稱</th>
                <th>收入</th>
                <th>支出</th>
                <th>操作
                    <button class="btn btn-primary" onclick="create()">新增</button>
                </th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</body>
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.5.2/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/7.5.2/firebase-database.js"></script>

<script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
        apiKey: "AIzaSyDv2DVeL70NP-L4xPaI3xiuHmnTlaW7uHE",
        authDomain: "ajax-test-9ccfc.firebaseapp.com",
        databaseURL: "https://ajax-test-9ccfc.firebaseio.com",
        projectId: "ajax-test-9ccfc",
        storageBucket: "ajax-test-9ccfc.appspot.com",
        messagingSenderId: "345382045351",
        appId: "1:345382045351:web:ba1d81870f6aaf8f583d82",
        measurementId: "G-CN7CN0RYCG"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
</script>
<script>
	// 當資料有變更，刷新頁面顯示
    firebase.database().ref("/balance").on("value", response => {
        var balanceTable = Array.from(response.val()) || [];

        document.querySelector("tbody").innerHTML = "";

        balanceTable.forEach(balance => {
            if (!balance) return;
            document.querySelector("tbody").innerHTML += (
                `<tr>
                    <td>${balance.name}</td>
                    <td>${balance.debit}</td>
                    <td>${balance.credit}</td>
                    <td>
                        <button class="btn btn-warning" onclick="modify(${balance.id}, '${balance.name}', '${balance.debit}', '${balance.credit}')">編輯</button>
                        <button class="btn btn-danger" onclick="remove(${balance.id})">刪除</button>
                    </td>
                </tr>`
            );
        });
    });

	// 修改內容
    function modify(id, name, debit, credit) {
        var name = prompt("名稱", name);
        if (!name) return alert("已取消更新");

        var debit = prompt("收入", debit);
        if (!debit) return alert("已取消更新");

        var credit = prompt("支出", credit);
        if (!credit) return alert("已取消更新");

        firebase.database().ref("/balance/" + id).update({
            id, name, debit, credit
        });         
    }

	// 資料刪除
    function remove(id) {
        if (!confirm("確認刪除?")) return;
        
        firebase.database().ref("/balance/" + id).remove();
    }

	// 資料新增
    function create() {
        var name = prompt("名稱");
        if (!name) return alert("已取消新增");

        var debit = prompt("收入");
        if (!debit) return alert("已取消新增");

        var credit = prompt("支出");
        if (!credit) return alert("已取消新增");

        firebase.database().ref("/balance/length").once("value", response => {
            var length = response.val() || 0;
            var id = length;
            firebase.database().ref("/balance/length").set(length + 1);
            firebase.database().ref("/balance/" + id).set({
                id, name, debit, credit
            });
        });
    }
</script>

</html>